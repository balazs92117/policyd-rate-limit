#! /usr/bin/make -f

#export DH_VERBOSE = 1
export PYBUILD_NAME = policyd-rate-limit

PKD  = $(abspath $(dir $(MAKEFILE_LIST)))
PKG  = $(word 2,$(shell dpkg-parsechangelog -l$(PKD)/changelog --show-field=Source))
VER  ?= $(shell dpkg-parsechangelog -l$(PKD)/changelog -SVersion | cut -d- -f1)

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_build:
	make man_files
	dh_auto_build

override_dh_auto_clean:
	dh_auto_clean
	make clean

get-orig-source:  $(info I: $(PKG)_$(VER))
	@echo "# Downloading..."
	uscan --noconf --verbose --rename --destdir=$(CURDIR) --check-dirname-level=0 --force-download --download-version $(VER) $(PKD)

set-source: get-orig-source
	rm -rf .pc
	tar --strip-components=1 -xf policyd-rate-limit_$(VER).orig.tar.gz
	mv policyd-rate-limit_$(VER).orig.tar.gz ../
